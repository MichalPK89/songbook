<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test</title>

  <style>
  .line {
    position: relative;
  }
  
  .chord-line {
    position: relative;
    font-weight: bold;
  }
  
  .chord {
    position: absolute;
  }
  
  .lyric-line {
    white-space: pre;
  }

  </style>



</head>
<body>

    <h1>Test</h1>

    <button onclick="transpose(1)">+ Transpose</button>
    <button onclick="transpose(-1)">- Transpose</button>

    <pre id="song"></pre>

    <!--
    <div class="line">
      <div class="chord-line">
        <span class="chord" style="left: 0ch">D</span>
        <span class="chord" style="left: 6ch">A</span>
      </div>
      <div class="lyric-line">
     I love you
      </div>
    </div>
    -->

    <script>

        let a =
        `[D]I love [A7]you[G2]
        I [A]can't li[Hmi]ve [A][D]with[D]out [G2]you
        Okay, let's go`

        function chordify(text) {

            text_lines = text.split("\n");
            let results = [];
            let line_num = 0;

            for (line of text_lines) {
                let chord_name = '';
                let index = 1;
                let chords = [];
                let chord = {}
                let text = '';
                line_num++;

                if (line.includes("[")) {

                    for (character of line) {

                        // ak sa nájde začiatok akordu
                        if (character == "[") {
                            active_chord = 1;
                            chord_pos = index;

                        } else if (character == "]" && active_chord == 1) {
                            active_chord = 0;
                            chord.pos = chord_pos;
                            chord.name = chord_name;

                            chords.push({ name: chord.name, pos: chord.pos });

                            chord_name = '';

                        } else if (active_chord == 0) {
                            index++;
                            text = text + character;
                        } else if (active_chord == 1 && character != "[") {
                            chord_name = chord_name + character;
                        }
                    }
                    results.push({ line_num, chords, text });
                } else {
                    results.push({ line_num, line });
                }
            }

            return results;
        }


       

    

        parsedResults = chordify(a);
        text = "";

        for (let i = 0; i < parsedResults.length; i++) {
            text += parsedResults[i];
            text += "\n"
        }



        

        const songEl = document.getElementById("song");
        songEl.innerHTML = text;
    

    </script>

</body>
</html>
